%Purge and clean
clear all;
clc;

%Vehicle parameters
weight_N = 18680;
area_sq_m = 2.4;
Cd = 0.44;
Wheel_base = 2.89;
Front_rear_ratio = 0.52; 
base_height_ratio = 3.71;
density = 1.225; %kg/m^3
radius_wheel_m = 0.318;

%M-number drive cycle for testing
M_number = [0 9 4 0 4 5 2 0 7];
vel_m_s = M_number*3;
vel_mph = vel_m_s*2.24;
time_scale = 0:8;
time_s = time_scale*100;

%Malibu drive cycle
Time = xlsread('Malibu_20100929_Highway_HW_9_10_2012','A:A');
Velocity_kph = xlsread('Malibu_20100929_Highway_HW_9_10_2012','B:B');%mps
Velocity_mps = xlsread('Malibu_20100929_Highway_HW_9_10_2012','B:B')*1/3.6;


%E-motor characteristics
torque(1:1100) = 650;

for i = 1101:5000
    torque(i) = (-0.0949*i)+754.36;
end

rpm = 1:5000;
radpersec = rpm*(pi/30);
power_kW = 1/1000*((torque).*(radpersec));

%E-motor Plots
% figure(1)
% plot(rpm,torque)
% xlabel('RPM')
% ylabel('Torque in Nm')
% title('Torque characteristics of Emotor')

% figure(2)
% plot(power_kW)
% xlabel('RPM')
% ylabel('Power in KW')
% title('Power Characteristics of an Emotor')



%Engine Data from HW-7
TORQUE_ICE=[0.000	10.552	21.103	31.655	42.206	52.758	63.310	73.861	84.415	94.966	105.518	116.069	126.621	137.173	147.724	158.276	168.827	179.379	189.931	200.482	211.034	221.585	232.139	242.690	253.242	263.794	274.345	284.897	295.448	306.000];


OMEGA_ICE=[1000.000	1146.552	1293.103	1439.655	1586.207	1732.759	1879.310	2025.862	2172.414	2318.966	2465.517	2612.069	2758.621	2905.172	3051.724	3198.276	3344.828	3491.379	3637.931	3784.483	3931.034	4077.586	4224.138	4370.690	4517.241	4663.793	4810.345	4956.897	5103.448	5250.000];	

POWER_ICE = (TORQUE_ICE.*(OMEGA_ICE*pi/30))/1000;

FUEL_FLOW=[0.2022	0.2508	0.2922	0.6462	0.6588	0.6786	0.8658	0.909	0.9738	1.107	1.0854	0.963	1.1214	1.4184	1.1772	1.2276	1.2546	1.2924	1.494	1.5264	1.422	2.475	3.0402	2.9214	2.322	1.4886	0.5832	0.0018	0.0036	0.0054;
0.2004	0.3552	0.648	0.657	0.7254	0.7686	0.81	0.99	1.1178	1.1214	1.152	1.2384	1.4256	1.5138	1.4544	1.4292	1.5876	1.7046	1.5552	1.6362	1.3122	2.6802	2.8314	2.5344	2.016	1.4544	0.8622	0.2502	0.0036	0.0054;
0.5436	0.6498	0.675	0.7308	0.9324	0.9396	0.9972	1.0368	1.3122	1.3536	1.2708	1.3356	1.5066	1.6452	1.7154	1.6758	1.6938	2.0484	2.4462	2.025	2.0484	2.655	2.6694	2.331	1.8738	1.5462	1.2114	0.8514	0.4752	0.108;
0.4824	0.6102	0.7704	0.864	0.9072	0.9558	1.08	1.0854	1.3032	1.3896	1.4436	1.5192	1.7424	1.9674	2.0088	2.0016	2.142	2.4246	2.5992	3.915	3.213	3.0384	2.745	2.3652	2.043	1.8414	1.6776	1.5048	1.3176	1.1484;
0.63	0.6822	0.756	0.9252	1.0872	1.1556	1.2078	1.2924	1.4166	1.6704	1.8126	1.881	2.0952	2.2464	2.3184	2.907	2.9646	3.537	3.897	3.9078	3.5856	3.3714	2.9142	2.5308	2.3472	2.2644	2.2302	2.2014	2.1438	2.1114;
1.0692	1.0422	1.0332	1.2546	1.377	1.5192	1.6326	1.7064	1.9368	2.2248	2.1564	2.178	2.385	2.4984	2.826	3.123	3.465	3.8664	3.708	3.1464	3.483	3.7008	3.1374	2.8692	2.7792	2.763	2.8206	2.8998	2.916	2.9574;
0.8316	1.0134	1.0962	1.3338	1.719	1.9818	2.0196	2.0232	2.1528	2.5866	2.5416	2.7036	2.889	2.97	3.0438	3.3156	3.2418	3.3606	3.3966	3.2382	3.6486	4.2318	3.3282	3.3282	3.3012	3.2598	3.3606	3.5244	3.5856	3.672;
1.0278	1.2096	1.224	2.4516	1.7208	1.6812	1.8072	2.2806	2.3202	2.3346	2.8476	3.1374	3.258	3.4164	3.501	3.4974	3.4128	3.2958	3.834	3.4722	3.438	3.7818	3.7998	4.212	3.8808	3.6576	3.744	3.852	4.0572	4.3218;
1.071	1.3986	1.6758	1.9818	2.0394	2.1006	2.2428	2.3976	2.7918	3.3012	3.303	3.5766	3.6162	3.7242	3.834	4.005	3.96	4.0626	4.0788	4.1436	4.3002	4.158	4.0122	3.879	3.9258	3.8826	4.1544	4.1544	4.4748	4.5072;
1.1268	1.6092	1.9134	2.0772	2.2302	2.4606	2.502	2.9178	3.4182	3.5046	4.0122	3.7926	3.9726	4.1832	4.2624	4.23	4.5108	4.1814	4.3686	4.3812	4.473	4.4226	4.3812	4.473	4.473	4.6782	4.9266	4.7484	4.8402	5.0094;
1.4832	1.6398	2.313	2.25	2.8422	2.8314	2.8062	3.294	3.3264	3.8466	4.2102	4.2426	4.248	4.608	4.518	4.5342	4.617	4.4856	4.5072	4.4532	4.4532	4.5144	4.5594	4.7106	4.9032	5.2794	5.2038	5.1552	5.1696	5.4504;
1.9746	2.5992	2.6928	2.7918	2.7072	2.7306	2.9466	3.735	3.9528	4.356	4.0374	4.5738	4.4658	4.8276	5.013	4.9086	4.8348	4.8492	4.8132	4.7466	4.7988	4.8168	4.8384	4.9284	5.1336	5.6934	5.76	5.6916	5.4756	5.9634;
1.6974	1.7154	2.2032	2.5236	2.8872	3.4488	2.9376	3.168	3.276	4.5648	4.3236	4.671	4.7394	5.0274	5.1426	5.1696	5.1894	5.418	5.3586	5.2758	5.472	5.436	5.3946	5.3964	5.4612	6.273	6.2136	6.048	5.8248	6.444;
2.3724	2.3598	2.4642	2.7684	3.2436	2.9394	2.8098	3.771	4.9482	4.581	4.4298	5.2686	5.274	5.4108	5.4684	5.4216	6.2532	6.2604	6.1488	6.156	6.4476	6.4962	6.4026	6.435	6.8364	6.849	6.7824	6.507	6.408	6.2892;
1.8198	2.484	2.5848	2.6226	3.303	3.015	3.0636	3.933	4.7466	4.572	4.5234	5.2308	5.5386	5.5224	5.6844	5.9274	6.5268	6.6978	6.6654	6.6024	6.5736	6.597	6.9336	6.984	6.9426	7.1172	7.2558	6.8976	6.561	6.2964;
2.0718	2.4804	2.9952	3.114	3.3732	3.2148	3.492	4.1418	4.6782	4.6908	4.5522	5.2902	5.6952	5.6916	5.9094	6.2766	6.7518	7.0038	7.0632	7.0236	6.9714	7.0146	7.2414	7.3548	7.4034	7.5888	7.6662	7.5474	7.1586	6.7644;
2.8908	3.0636	3.5712	3.2724	3.6756	3.7062	4.0212	4.5018	4.8852	4.9842	5.1138	5.697	5.895	5.7762	6.12	6.5736	7.0236	7.3152	7.4502	7.4538	7.4142	7.434	7.56	7.6896	7.7616	7.8444	7.9074	7.92	7.7382	7.4862;
3.0582	3.3732	3.2904	3.4794	3.4632	3.9834	4.5054	4.9086	5.1822	5.1822	5.4018	5.8104	6.039	6.1434	6.4818	6.9336	7.3692	7.6608	7.8624	7.8894	7.8462	7.8228	7.884	8.0334	8.0748	8.1	8.1576	8.3142	8.325	8.2746;
2.9736	3.2598	3.3588	3.7818	4.0716	4.6062	5.0976	5.2704	5.3424	5.3334	5.5764	5.9274	6.2226	6.4872	6.858	7.308	7.7418	7.9974	8.2836	8.3124	8.2638	8.2098	8.2098	8.4078	8.3214	8.055	8.478	8.8182	8.9244	9.0018;
3.1032	3.6108	4.0734	4.4568	4.779	5.2398	5.6538	5.5278	5.3622	5.4828	5.7528	6.0948	6.4368	6.7842	7.182	7.6158	8.0208	8.3214	8.5752	8.6706	8.6796	8.6724	8.6994	8.8074	8.7984	8.802	9.2214	9.4428	9.4788	9.5832;
3.3264	3.969	4.7088	4.9644	5.1516	5.4468	5.5944	5.7402	5.6484	5.7366	5.976	6.3018	6.6636	7.047	7.4592	7.8822	8.2764	8.6004	8.8578	9.0126	9.0972	9.1548	9.2232	9.3114	9.3564	9.405	9.5256	9.5778	9.8136	10.0188;
3.555	3.969	4.4928	4.7232	4.9932	5.2938	5.5116	5.706	5.787	5.9346	6.1848	6.5106	6.8832	7.2864	7.7058	8.1252	8.5194	8.8614	9.1422	9.3546	9.5094	9.6372	9.7578	9.8748	9.972	10.0818	10.2492	10.2492	10.3248	10.4508;
3.969	4.1634	4.212	4.2678	4.6422	5.0238	5.3388	5.607	5.8194	6.0534	6.345	6.6924	7.083	7.4988	7.929	8.3538	8.7552	9.117	9.4302	9.693	9.9126	10.107	10.2852	10.4436	10.5588	10.6056	10.5678	10.6956	10.791	10.8846;
4.1472	4.104	4.0734	4.1382	4.4334	4.8006	5.1588	5.49	5.796	6.111	6.4566	6.8418	7.2558	7.6914	8.1342	8.5698	8.9838	9.3672	9.7128	10.0206	10.2978	10.5516	10.791	11.007	11.1852	11.2896	11.3058	11.2752	11.2806	11.3202;
4.0698	3.9546	3.9312	4.0248	4.2786	4.6224	4.9968	5.373	5.7474	6.129	6.5322	6.9588	7.4052	7.8642	8.325	8.7768	9.2088	9.6138	9.99	10.3338	10.6542	10.9566	11.2446	11.5182	11.7576	11.9052	11.8386	11.763	11.727	11.7306;
3.7944	3.7116	3.7332	3.8628	4.1148	4.4532	4.8438	5.256	5.6826	6.1236	6.579	7.0506	7.5348	8.0244	8.5086	8.9802	9.432	9.8568	10.2546	10.6272	10.9764	11.3112	11.628	11.925	12.195	12.3966	12.2292	12.1464	12.1104	12.1068;
3.3822	3.3786	3.4632	3.6414	3.915	4.2678	4.68	5.13	5.6034	6.0984	6.6078	7.128	7.6554	8.1792	8.6922	9.1854	9.657	10.098	10.5138	10.9026	11.2716	11.6208	11.9466	12.2238	12.4056	12.4344	12.4344	12.4632	12.4596	12.4578;
2.8782	2.97	3.1248	3.3552	3.6648	4.0482	4.4928	4.9824	5.508	6.057	6.624	7.1982	7.7706	8.3358	8.8812	9.4014	9.891	10.3464	10.7712	11.1708	11.5488	11.9142	12.2616	12.5712	12.7962	12.9042	12.9456	12.9006	12.8268	12.7962;
2.3202	2.502	2.7252	3.0096	3.3606	3.7818	4.2678	4.806	5.3874	5.9994	6.6294	7.2648	7.893	8.505	9.09	9.6372	10.1448	10.611	11.0394	11.4372	11.8188	12.1986	12.5892	12.987	13.3218	13.5414	13.6188	13.3722	13.1544	13.1184;
1.737	1.9926	2.2734	2.6028	2.9952	3.4596	3.9942	4.5918	5.2398	5.9238	6.6276	7.335	8.0316	8.6994	9.3294	9.909	10.4364	10.9062	11.3274	11.7108	12.078	12.4596	12.8988	13.4496	13.9446	14.2254	14.1552	13.6962	13.2696	13.4154];

%Engine data plotsfigure(1)
% figure(3)
% plot(OMEGA_ICE,TORQUE_ICE,'r')

% 

% title('3-D plot manifesting Fuel flow at various speeds(RPM) and torques(Nm)')
% figure(6)
mesh(OMEGA_ICE,TORQUE_ICE,FUEL_FLOW)

% hold on
% plot(rpm,torque,'g')
% hold off

%simulatiom of model HW9_adrabha_sim
% sim('adarbha_HW9_sim.mdl')

%Plots
% figure(5)
% hold on
% plot(power_kW,rpm)
% plot()

% plot(OMEGA_ICE,POWER_ICE);

%E-motor and battery parameters

V_o = 300;
Q = 20; %amp_hr
R_batt = 0.1; %ohm



